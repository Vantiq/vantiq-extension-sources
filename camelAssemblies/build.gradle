import io.vantiq.extsrc.assy.tasks.AssemblyResourceGeneration

repositories {
    mavenCentral()
}

dependencies {
    implementation "org.apache.camel.kamelets:camel-kamelets:3.20.2"
}

ext {
    generatedResourceBase = 'vantiqGeneratedResources'
    zippedAssemblies = 'vantiqAssemblies'
}

tasks.withType(JavaCompile) {
    options.encoding = 'UTF-8'
}

test {
    useJUnitPlatform()
}

task zipAssemblies

File vtqResources = new File(project.buildDir, "${generatedResourceBase}")
File vtqAssemblies = new File(project.buildDir, "${zippedAssemblies}")
vtqResources.eachDir { resourceDir ->
    def taskName = "zip${resourceDir.name.capitalize()}"
    task "${taskName}"(type: Zip) {
        it.inputs.dir(vtqResources)
        from resourceDir
        destinationDir vtqAssemblies
        baseName resourceDir.name
    }
    zipAssemblies.dependsOn taskName
}

tasks.register('generateAssemblyResources', AssemblyResourceGeneration)

assemble.finalizedBy('generateAssemblyResources')
generateAssemblyResources.finalizedBy('zipAssemblies')
